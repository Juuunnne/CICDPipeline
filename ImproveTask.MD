# CI/CD Pipeline – Improvement Plan

This document lists the tasks required to address the key gaps identified in the current pipeline implementation, their dependencies, and the recommended execution order.

---

## 1. Task List & Priorities

| ID | Priority | Task | Key Outcome |
|----|----------|------|-------------|
| T1 | 🔴 High | **Enable write-permissions for the workflow** – add `permissions: contents: write` to the root of `.github/workflows/ci-cd.yml`. | Workflow can push commits & tags and create releases. |
| T2 | 🔴 High | **Push `standard-version` commit & tag inside CI** – add a `git push --follow-tags origin master` step **after** the `standard-version` step in the `release` job. | Version bump commit & tag are automatically sent to GitHub. |
| T3 | 🔴 High | **Re-enable GitHub Release creation** – uncomment (or replace) the `softprops/action-gh-release` step and attach generated artefacts. | A formal GitHub Release is generated per version with zipped build artefacts and changelog. |
| T4 | 🔴 High | **Create `release-tag.yml` workflow** that triggers on `push` of tags (`v*`) and publishes the release artefacts (build & zip) to GitHub Releases (fallback in case T3 fails). | Tag builds are reproducible and artefacts are published even if the CI tag push triggers a separate workflow run. |
| T5 | 🟠 Medium | **Prevent infinite loops** – guard the release step so it **does not** run on commits generated by `standard-version` (e.g., `if: ${{ !contains(github.event.head_commit.message, 'chore(release):') }}`). | Ensures the pipeline runs once per logical change set. |
| T6 | 🟠 Medium | **Add job-level caching & matrix testing** – cache `node_modules` and test against Node 18 & 20. | Faster builds, broader environment coverage. |
| T7 | 🟢 Low | **Automate changelog upload to Release assets** (e.g., attach `CHANGELOG.md` as a separate file). | Easier consumption of changes. |
| T8 | 🟢 Low | **Documentation & badges** – update `README.md` with build status & release badge; document manual trigger fallback. | Better project visibility & onboarding. |

---

## 2. Dependency Map

```
T1 ➡️ T2, T3 (workflow needs write permission before it can push or create releases)
T2 ➡️ T4 (tag push is prerequisite for tag-based workflow)
T3 ➡️ (independent after T1, but logically after T2 so the tag exists)
T4 ⬅️ depends on presence of tag (generated by T2)
T5 ➡️ safeguards T2/T3 (implement alongside them)
T6, T7, T8 ➡️ can be implemented anytime after T1
```

---

## 3. Detailed Implementation Notes

### T1 – Enable write-permissions
1. Add at the **top-level** of `.github/workflows/ci-cd.yml`:
   ```yaml
   permissions:
     contents: write  # allows pushing commits/tags & creating releases
   ```
2. No additional secrets required – `GITHUB_TOKEN` inherits write access when this permission is set.

### T2 – Push commit & tag
1. Insert a step **immediately after** `npm run release`:
   ```yaml
   - name: Push version commit & tag
     run: |
       git push --follow-tags origin master
   ```
2. Uses default `GITHUB_TOKEN` – no PAT necessary.

### T3 – Re-enable GitHub Release step
1. Uncomment existing block **or** switch to `ncipollo/release-action`:
   ```yaml
   - name: Create GitHub Release 🇬🇧
     uses: ncipollo/release-action@v1
     with:
       tag: v${{ steps.extract_version.outputs.version }}
       name: Release v${{ steps.extract_version.outputs.version }}
       bodyFile: CHANGELOG.md
       artifacts: "./cicdpipeline-${{ steps.extract_version.outputs.version }}.zip"
   ```

### T4 – Add `release-tag.yml`
Create `.github/workflows/release-tag.yml`:
```yaml
name: Release Tag Build
on:
  push:
    tags:
      - "v*"
permissions:
  contents: write
jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18.x
          cache: "npm"
      - run: npm ci
      - run: npm run build
      - run: zip -r cicdpipeline.zip dist
      - name: Upload artefact & create release
        uses: ncipollo/release-action@v1
        with:
          artifacts: cicdpipeline.zip
```

### T5 – Prevent loops
Add a conditional to the `release` job (or to the `Create Release with standard-version` step):
```yaml
if: ${{ !contains(github.event.head_commit.message, 'chore(release):') }}
```

### T6 – Caching & Matrix
Add caching and expand matrix to Node 18 & 20 for `test` and `build` jobs.

---

## 4. Best-Practice Execution Order

1. **T1** – Grant write permissions (small, isolated change).
2. **T2** – Push commit & tag (validate end-to-end; observe tag on repo).
3. **T3** – Re-enable Release creation (verify artefacts attached).
4. **T4** – Add tag-based workflow (defence-in-depth; verify triggers).
5. **T5** – Add loop-prevention guard (after confirming release works).
6. **T6** – Introduce caching & multi-version testing (performance/quality).
7. **T7** – Attach changelog asset (nice-to-have polish).
8. **T8** – Update documentation & badges.

---

✅ When all **High** priority tasks are merged, the pipeline will be fully automated: each push to `master` will test, build, version, push tags, and publish a GitHub Release with artefacts – **without** manual intervention. 